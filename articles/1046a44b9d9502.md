---
title: "render hooks ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç´ æŒ¯ã‚Š"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['react', 'hooks']
published: true
---

ä»¥ä¸‹ã®è¨˜äº‹ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã€Œrender hooks ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãŒã™ã”ãè‰¯ã„ãªã¨æ€ã£ãŸã®ã§ã€å®Ÿéš›ã«æ¥­å‹™ã§åˆ©ç”¨ã—ãŸæ§‹æˆã‚’å…ƒã«å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚

https://engineering.linecorp.com/ja/blog/line-securities-frontend-3/


# æœ€é€±çš„ãªå®Ÿè£…
ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ç›´ä¸‹ã«ç”»åƒã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã‚Šã¾ã—ãŸã€‚

@[codesandbox](https://codesandbox.io/embed/awesome-meninsky-3q92v6?fontsize=14&hidenavigation=1&theme=dark)

ã“ã¡ã‚‰ã‚’å…ƒã«è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

# ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ã‚ãªã„å®Ÿè£…

ä»¥ä¸‹ã¯ç‰¹ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚‚åˆ©ç”¨ã›ãšã«å®Ÿè£…ã—ãŸå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚
`<input type="file" />`ã«å…¥åŠ›ãŒã‚ã£ãŸã®ã‚’`handleInput()`ã§ç”»åƒã‚’ data URL ã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚

```tsx:src/app.tsx
import { useState } from "react";

export default function App() {
  const [value, setValue] = useState<string | null>(null);

  const handleInput = (changeEvent: React.ChangeEvent<HTMLInputElement>) => {
    const file = changeEvent.target.files ? changeEvent.target.files[0] : null;
    if (!file) {
      return;
    }
    const reader = new FileReader();
    reader.onload = (event: ProgressEvent<FileReader>) => {
      if (typeof event?.target?.result === "string") {
        setValue(event.target.result);
      }
    };
    reader.readAsDataURL(file);
  };

  return (
    <div className="App">
      <input type="file" accept="image/*" onChange={handleInput} />
      {value && <img src={value} alt="preview" />}
    </div>
  );
}
```

# `<input>` ã« render hooks ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©å¿œã—ãŸå®Ÿè£…

ã¾ãšã¯ã€`<input type="file" />`ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‹ã‚‰æä¾›ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™ã€‚


```tsx:src/use-image-file-input.tsx
import { useState } from "react";

export default function useInputImageFile() {
  const [imageDataUrl, setImageDataUrl] = useState<string | null>(null);

  const handleInput = (changeEvent: React.ChangeEvent<HTMLInputElement>) => {
    const file = changeEvent.target.files ? changeEvent.target.files[0] : null;
    if (!file) {
      return;
    }
    const reader = new FileReader();
    reader.onload = (event: ProgressEvent<FileReader>) => {
      if (typeof event?.target?.result === "string") {
        setImageDataUrl(event.target.result);
      }
    };
    reader.readAsDataURL(file);
  };

  const imageFileInput = () => 
  <input type="file" accept="image/*" onChange={handleInput} />

  return {
    imageDataUrl,
    imageFileInput,
  }
}
```

app.tsx ã«è¨˜è¼‰ã—ã¦ã„ãŸç”»åƒãƒ•ã‚¡ã‚¤ãƒ«å–å¾—å¾Œã®ãƒ­ã‚¸ãƒƒã‚¯ãŒã»ã¨ã‚“ã©ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«ç§»å‹•ã—ã¾ã—ãŸã€‚ã“ã®æ™‚ã€app.tsx ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx:src/app.tsx
import { useImageFileInput } from "./use-image-file-input";

export default function App() {
  const { imageDataUrl, ImageFileInput } = useImageFileInput();

  return (
    <div className="App">
      <ImageFileInput />
      {imageDataUrl && <img src={imageDataUrl} alt="preview" />}
    </div>
  );
}
```

ãƒ­ã‚¸ãƒƒã‚¯ãŒã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«å‡é›†ã•ã‚ŒãŸã“ã¨ã«ã‚ˆã‚Šã€ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã¾ã—ãŸã€‚`ImageFileInput`ãŒé€šå¸¸ã®`useState`ã® set é–¢æ•°ã®ã‚ˆã†ã«æŒ¯ã‚‹èˆã†ã®ã§ã€ä½¿ã„ã‚„ã™ã„ã¨ã„ã†ã®ã‚‚æ°—ã«å…¥ã£ã¦ã„ã¾ã™ã€‚

# ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã‚‚ render hooks ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©å¿œã—ãŸå®Ÿè£…

ç”»åƒå–å¾—ã—ãŸå¾Œã«è¡¨ç¤ºã™ã‚‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚‚ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã®è²¬å‹™ã«ã—ã¦ã—ã¾ã„ã¾ã—ã‚‡ã†ã€‚`useImageFileInput`ã‚’`useImageFile`ã«ãƒªãƒãƒ¼ãƒ ã—ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚æä¾›ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff tsx:src/use-image-file.tsx
  import { useState } from "react";

- export function useImageFileInput() {
+ export function useImageFile() {
    const [imageDataUrl, setImageDataUrl] = useState<string | null>(null);

    const handleInput = (changeEvent: React.ChangeEvent<HTMLInputElement>) => {
        const file = changeEvent.target.files ? changeEvent.target.files[0] : null;
        if (!file) {
        return;
        }
        const reader = new FileReader();
        reader.onload = (event: ProgressEvent<FileReader>) => {
        if (typeof event?.target?.result === "string") {
            setImageDataUrl(event.target.result);
        }
        };
        reader.readAsDataURL(file);
    };

    const ImageFileInput = () => (
        <input type="file" accept="image/*" onChange={handleInput} />
    );

+   const ImagePreview = () =>
+       imageDataUrl ? <img src={imageDataUrl} alt="preview" /> : <></>;

    return {
        imageDataUrl,
        ImageFileInput,
+       ImagePreview
    };
  }
```

app.tsx ã«ã¯åˆ†å²ã‚‚ç„¡ããªã‚Šã€ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã¾ã—ãŸã€‚

```diff tsx:src/app.tsx
- import { useImageFile } from "./use-image-file-input";
+ import { useImageFile } from "./use-image-file";

  export default function App() {
-   const { imageDataUrl, ImageFileInput } = useImageFileInput();
+   const { ImageFileInput, ImagePreview } = useImageFile();

    return (
      <div className="App">
        <ImageFileInput />
-       {imageDataUrl && <img src={imageDataUrl} alt="preview" />}
+       <ImagePreview />
      </div>
    );
  }
```

ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨ã—ã¦ç”»åƒå…¥åŠ›ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å‡ºåŠ›ã‚’æä¾›ã™ã‚‹ã“ã¨ã§å†åˆ©ç”¨æ€§ãŒé«˜ã¾ã‚‹ã¨æ€ã„ã¾ã™ã€‚ä¾‹ãˆã°ç”»åƒãŒæœªé¸æŠã®éš›ã«ã€Œç”»åƒãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤ºã—ãŸã„å ´åˆã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å†…ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å®šç¾©ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…¨ã¦ã«åæ˜ ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»–ã«ã‚‚é¸æŠç”»åƒã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚’æä¾›ã™ã‚‹ãªã©ã€åˆ©ç”¨ã—ã‚„ã™ã„ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ãŒä½œã‚Œãã†ã§ã™ã€‚

# ã¾ã¨ã‚

ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®å…¥å‡ºåŠ›ã‚’é¡Œæã«ã€render hooks ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¾‹ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚è¡¨ç¾ã®å¹…ãŒåºƒãŒã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã ã¨æ„Ÿã˜ã¦ãŠã‚Šã€ä»Šå¾Œã‚‚è¦æ‰€ã§åˆ©ç”¨ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¾ã¨ã‚ã¦ã‚ã‚Šã¾ã™ã€‚

https://github.com/MssKnd/render-hooks-demo
