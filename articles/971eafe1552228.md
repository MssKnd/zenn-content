---
title: "ã‚¯ãƒ©ã‚¹ã‚’é–¢æ•°ã«æ›¸ãæ›ãˆã‚‹ in TypeScript"
emoji: "âš½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [TypeScript, é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°]
published: true
---

:::message
è‘—è€…ã®è©¦è¡Œã®å‚™å¿˜éŒ²ã§ã™ã€‚
:::

# ãŠé¡Œ

ä»Šå›æ‰±ã†ã®ã¯ä»¥ä¸‹ã®ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

```ts
export class Path {
  constructor(private pathString: string) {}

  toString() {
    return this.pathString;
  }

  fillIds(ids: { [id: string]: string | number }) {
    let _pathString = this.pathString;
      for (const id in ids) {
      _pathString = _pathString.replace(`:${id}`, ids[id].toString());
    }
    return new Path(_pathString);
  }

  appendQueries(queries: { [query: string]: string | number }) {
    const queryString = Object.keys(queries)
      .map((key) => `${key}=${queries[key]}`)
      .join("&");
    if (this.pathString.includes("?")) {
      return new Path(`${this.pathString}&${queryString}`);
    }
    return new Path(`${this.pathString}?${queryString}`);
  }
}
```

path æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã€`'/resource/:resourceId'` å½¢å¼ã® path æ–‡å­—åˆ—ã®æ“ä½œã¨å‡ºåŠ›ãŒå¯èƒ½ã§ã™ã€‚ä»¥ä¸‹ãŒå®Ÿè¡Œä¾‹ã«ãªã‚Šã¾ã™ã€‚

```ts
const userVideoPagePath = new Path('/user/:userId/video/:videoId');

userVideoPagePath.toString(); // '/user/:userId/video/:videoId'

userVideoPagePath.fillIds({
  userId: 1000,
  videoId: 30,
}).toString(); // '/user/1000/video/30'

userVideoPagePath.fillIds({
  userId: 2000,
  videoId: 10,
}).appendQueries({
  timestamp: 1650753766,
}).toString(); // '/user/2000/video/10?timestamp=1650753766'
```

`toString()` ä»¥å¤–ã®ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã¯æ–°ãŸãª Path ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚ã“ã‚Œã¯ method chaine ãŒ fluent interface ã«ãªã‚‹ã‚ˆã†ã«æ„è­˜ã—ã¦ã„ã¾ã™ã€‚


# é–¢æ•°åŒ–

`Path` ã‚’é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ä½¿ã£ã¦æ›¸ãæ›ãˆãŸã‚‚ã®ãŒã“ã¡ã‚‰ã§ã™ã€‚

```ts
const pathGenerator = (pathString: string) =>
  ({
    generate: () => pathString,
    fillIds: (ids: { [idName: string]: string | number }) => {
      let _pathString = pathString;
      for (const idName in ids) {
        _pathString = _pathString.replace(`:${idName}`, ids[idName].toString());
      }
      return pathGenerator(_pathString);
    },
    appendQueries: (queries: { [queryName: string]: string | number }) => {
      const queryString = Object.keys(queries)
        .map((queryName) => `${queryName}=${queries[queryName]}`)
        .join("&");
      if (pathString.includes("?")) {
        return pathGenerator(`${pathString}&${queryString}`);
      }
      return pathGenerator(`${pathString}?${queryString}`);
    },
  } as const);
```

ä¸ãˆã‚‰ã‚ŒãŸ `pathString` ã®å€¤ã‚’ä¿æŒã—ã€å„é–¢æ•°ã§é…å»¶è©•ä¾¡ã—ã¦æ–°ãŸãª `pathGenerator` ã‚’è¿”ã—ã¾ã™ã€‚ãªã‚“ã¨ãªã Generator ã‹ãªã¨æ€ã£ã¦ã“ã®ã‚ˆã†ãªåå‰ã«ã—ãŸã‚“ã§ã™ãŒã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ…£ä¾‹çš„ã«ã‚‚ã£ã¨é©ã—ãŸåå‰ãŒã‚ã‚Œã°æ•™ãˆã¦ä¸‹ã•ã„ ğŸ™‡

å®Ÿè¡Œä¾‹ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```ts
const userVideoPagePathGenerator = pathGenerator('/user/:userId/video/:videoId');

userVideoPagePathGenerator.generate(); // '/user/:userId/video/:videoId'

userVideoPagePathGenerator.fillIds({
  userId: 1000,
  videoId: 30,
}).generate(); // '/user/1000/video/30'

userVideoPagePathGenerator.fillIds({
  userId: 2000,
  videoId: 10,
}).appendQueries({
  timestamp: 1650753766,
}).generate(); // '/user/2000/video/10?timestamp=1650753766'
```

## å†ä»£å…¥ã—ãªã„ã‚ˆã†ã«ä¿®æ­£

`fillIds()` ã®ä¸­ã§ for æ–‡ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚å†ä»£å…¥ãŒå¿…è¦ã«ãªã£ã¦ã„ã¾ã™ã€‚`let` ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ãŒã‚¤ãƒã‚¤ãƒãªã®ã§ for æ–‡ã‚’ä½¿ã‚ãªã„æ›¸ãæ–¹ã«ä¿®æ­£ã—ã¾ã™ã€‚

### é…åˆ—ï¼ˆArray.map()ï¼‰

é…åˆ—ã®é–¢æ•°ã‚’åˆ©ç”¨ã—ãŸæ–¹æ³•ã¯ä»¥ä¸‹ã§ã™ã€‚

```ts
const pathGenerator = (pathString: string) => {
  generate: () => {/* çœç•¥ */},
  fillIds: (ids: { [idName: string]: string | number }) => {
    const replacedPathString = pathString
      .split('/')
      .map(path => {
        if(path[0] === ':') {
          const idName = path.slice(1);
          return ids[idName];
        }
        return path;
      }).join('/');
    return pathGenerator(replacedPathString)
  },
  appendQueries: () => {/* çœç•¥ */},
}
```

### å†å¸°

å†å¸°ã‚’åˆ©ç”¨ã—ãŸæ›¸ãæ–¹ã¯ä»¥ä¸‹ã§ã™ã€‚é…åˆ—ã‚’åˆ©ç”¨ã—ãŸæ–¹æ³•ã«æ¯”ã¹ã¦è¨˜è¿°é‡ãŒå¤šãã€èª­ã¿ã¥ã‚‰ã„å°è±¡ãŒã‚ã‚Šã¾ã™ã€‚

```ts
type PathGenerator = {
  generate: () => string;
  fillIds: (ids: { [idName: string]: string | number }) => PathGenerator;
  appendQueries: (queryies: {
    [queryName: string]: string | number;
  }) => PathGenerator;
};

const pathGenerator = (pathString: string): PathGenerator => {
  generate: () => {/* çœç•¥ */},
  fillIds: (ids: { [idName: string]: string | number }) => {
    const [firstIdName] = Object.keys(ids);
    if (!firstIdName) {ã€€// å†å¸°ã®çµ‚äº†æ¡ä»¶
      return pathGenerator(pathString);
    }
    const { [firstIdName]: firstValue, ...restIds } = ids;
    const replacedPathString = pathString.replace(`:${firstIdName}`, ids[firstIdName].toString());
    return pathGenerator(replacedPathString).fillIds(restIds); // æœ«å°¾å†å¸°
  },
  appendQueries: () => {/* çœç•¥ */},
}
```

`fillIds()` ãŒå†å¸°é–¢æ•°ã‚’ return ã—ã¦ã„ã‚‹ãŸã‚ã€`type PathGenerator` ã‚’ä½¿ã£ã¦å‹å®šç¾©ã—ãªã„ã¨[å‹æ¨è«–ãŒã§ããšã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™](https://www.typescriptlang.org/play?ts=4.6.2#code/PTAEBcE8AcFNQAoENwAsDisB2sBOKB7XUAXlAG8AoEUWgc2zxVgC5QAKASlID5QADYABJyAZ3C4AlljoBffgG5qYWgDNJAGw0BJACai27SfrblQAbWNtxUmQF1rE6XVAAfUFgCuAWwBGeUFluEj5kNEwcfHAiJRpaJGg4LF0ARU88SGR8bwMOaCRs3Ko42gt87MdbOgdQG2c3Dx9-XFiVQODQlAxGKJjlQKVKAGMCLHFQfPCewmIydknUAGUnGTZBETqZeW5gACo2MO7ImdBdsBDKWnYqUtAGY-BWDg6JruWqgBpL0vUtPVyjCYKBYrLUVtVKvV3F4-AEgrwKN9biMxuALOpcOI9HZSKAAPK+ABWsCG4AAdABrWCQUSA0ScJS3WiSVQcACEGKxum4NyZtFwsHAnlwWFeUweRHmb3BDKRpVkctoKPGZnMnPA2LY6oAakgNOkPqAycaBVzRIFccZRIymcq0QLoBokENYLpDu96mQFh6ZGSHU6XexFaV+CwROq9PIvnzmfo1ZJMRrdHYydEfXQuMHuEhzesxOD5DbbgKhSKxUcmNFcOx-c7Xe6ZWTfjp9DXYGbZbdZNHSgkkql0rhMgUkDlDOVR0UyiPvJD7HOXNCmnCXrzkaNxgBHQfDwq4gnE0mU6m0ic5TjB2hk7wJdjsKmQF78EQP2QkERn0TmB92baXo2EgQ0jsAARAAZCBnZMiyeTSlUZLSEM+q6O2oEAPyQTy-4lsKooLBElaSs+5DegWYEiNuGRZJO2xFvKwY4WW+HTFW7DEaRVSyGhFE7tROS0XK3bfLIoA5qAdqykAA)ã€‚

å‹å®šç¾©ã®åˆ†è¨˜è¼‰é‡ãŒå¢—ãˆã¾ã™ãŒã€æ¨è«–ã•ã‚Œã‚‹å‹ã¯èª­ã¿ã¥ã‚‰ã„ã®ã§å†å¸°ã§ãªãã¦ã‚‚è‡ªå‰ã®å‹å®šç¾©ãŒã‚ã£ã¦ã‚‚è‰¯ã„ã‹ãªã¨æ€ã„ã¾ã—ãŸã€‚


## ãŠã¾ã‘

é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã¯é–¢ä¿‚ãŒç„¡ã„ã§ã™ãŒã€pathString ãŒ `/` ã§å§‹ã¾ã‚‹ã‹ã©ã†ã‹ã‚’å‹ã§æ˜ç¤ºã™ã‚‹ã¨ä¾¿åˆ©ãã†ã§ã™ã€‚

```ts
const pathGenerator = (pathString: `/${string}`): PathGenerator => {
  // ä»–ã®ç®‡æ‰€ã‚‚é©å®œä¿®æ­£
```

# æœ€çµ‚ç³»

å†å¸°ã‚’åˆ©ç”¨ã—ãŸã‚„ã‚Šæ–¹ã§è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

```ts
type PathGenerator = {
  generate: () => `/${string}`;
  fillIds: (ids: { [id: string]: string | number }) => PathGenerator;
  appendQueries: (queryies: {
    [queryName: string]: string | number;
  }) => PathGenerator;
};

const pathGenerator = (pathString: `/${string}`): PathGenerator =>
  ({
    generate: () => pathString,
    fillIds: (ids: { [id: string]: string | number }) => {
      const [firstIdName] = Object.keys(ids);
      if (!firstIdName) {
        return pathGenerator(pathString);
      }
      const { [firstIdName]: firstValue, ...restIds } = ids;
      const replacedPathString = pathString.replace(
        `:${firstIdName}`,
        ids[firstIdName].toString()
      ) as `/${string}`;
      return pathGenerator(replacedPathString).fillIds(restIds);
    },
    appendQueries: (queries: { [queryName: string]: string | number }) => {
      const queryParams = Object.keys(params)
        .map((key) => `${key}=${params[key]}`)
        .join("&");
      if (pathString.includes("?")) {
        return pathGenerator(`${pathString}&${queryParams}`);
      }
      return pathGenerator(`${pathString}?${queryParams}`);
    },
  } as const);
```

# ã¾ã¨ã‚

ãŠé¡ŒãŒæ—¢ã«æ•´ã„éããŸæ„Ÿã˜ãŒã‚ã£ãŸã®ã§ã€æ¬¡ã‚„ã‚‹å ´åˆã¯ã‚‚ã£ã¨è¦ä»¶å®šç¾©ã‹ã‚‰ã‚„ã£ã¦ã‚‚ã„ã„ã‹ã‚‚ã€‚
